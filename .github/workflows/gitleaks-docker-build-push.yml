name: Gitleaks Docker Build and Push

on:
  push:
    branches: [main] # Ganti dengan branch yang sesuai

jobs:
  build-and-push:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout kode
        uses: actions/checkout@v3

      - name: Install dan Jalankan GitLeaks
        uses: gitleaks/gitleaks-action@v2
        with:
          config-path: .github/gitleaks.toml # Opsional, jika ingin custom config
          fail: true # Gagal jika ada kebocoran secrets
          verbose: true

      - name: Login ke Docker Hub
        uses: docker/login-action@v2
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Build image Docker
        run: docker build -t javiersosial/hello-world-gitaction:1.0 . # Ganti dengan nama dan tag image yang sesuai

      - name: Push image Docker ke Docker Hub
        run: docker push javiersosial/hello-world-gitaction:1.0
